CREATE DATABASE IF NOT EXISTS LOJA;
USE LOJA;
CREATE TABLE IF NOT EXISTS ITENS_COMPRADOS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    ID_NF INT,
    ID_ITEM INT,
    COD_PROD INT,
    VALOR_UNIT DECIMAL(10, 2),
    QUANTIDADE INT,
    DESCONTO FLOAT
);

INSERT INTO ITENS_COMPRADOS (ID, ID_NF, ID_ITEM, COD_PROD, VALOR_UNIT, QUANTIDADE, DESCONTO)
VALUES
(default,'1','1','1','25.00','10','5'),
(default,'1','2','2','13.50','3', NULL),
(default,'1','3','3','15.00','2', NULL),
(default,'1','4','4','10.00','1', NULL),
(default,'1','5','5','30.00','1', NULL),
(default,'2','1','3','15.00','4', NULL),
(default,'2','2','4','10.00','5', NULL),
(default,'2','3','5','30.00','7', NULL),
(default,'3','1','1','25.00','5', NULL),
(default,'3','2','4','10.00','4', NULL),
(default,'3','3','5','30.00','5', NULL),
(default,'3','4','2','13.50','7', NULL),
(default,'4','1','5','30.00','10','15'),
(default,'4','2','4','10.00','12','5'),
(default,'4','3','1','25.00','13','5'),
(default,'4','4','2','13.50','15','5'),
(default,'4','1','3','15.00','3', NULL),
(default,'5','2','5','30.00','3', NULL),
(default,'6','1','1','25.00','22','15'),
(default,'6','2','3','15.00','25','20'),
(default,'7','1','1','25.00','10','3'),
(default,'7','2','2','13.50','10','4'),
(default,'7','3','3','15.00','10','4'),
(default,'7','4','5','30.00','10','1');

SET SQL_SAFE_UPDATES=0;
UPDATE ITENS_COMPRADOS
SET DESCONTO = 3.5
WHERE DESCONTO = 5;
SELECT*FROM ITENS_COMPRADOS;

SELECT SUM(QUANTIDADE)
FROM ITENS_COMPRADOS
WHERE VALOR_UNIT > 25;
SELECT*FROM ITENS_COMPRADOS;

SELECT COUNT(*)
FROM ITENS_COMPRADOS
WHERE COD_PROD = 1;

select AVG(VALOR_UNIT)
FROM ITENS_COMPRADOS;

SELECT SUM((VALOR_UNIT - (VALOR_UNIT * (COALESCE(DESCONTO, 0) / 100))) * QUANTIDADE) AS "VALOR TOTAL VENDIDO"
FROM ITENS_COMPRADOS;

SELECT
MIN(VALOR_UNIT) AS MENOR_PRECO,
MAX(VALOR_UNIT) AS MAIOR_PRECO
FROM ITENS_COMPRADOS;

SELECT COD_PROD, COUNT(*) AS QUANTIDADE
FROM ITENS_COMPRADOS
GROUP BY COD_PROD
ORDER BY COD_PROD ASC;

SELECT ID_NF, ID_ITEM, COD_PROD, VALOR_UNIT
FROM ITENS_COMPRADOS
WHERE DESCONTO IS NULL OR DESCONTO=0;

SELECT ID_NF, ID_ITEM, COD_PROD, VALOR_UNIT, (VALOR_UNIT-(VALOR_UNIT*DESCONTO/100)) AS VALOR_VENDIDO
FROM ITENS_COMPRADOS
WHERE DESCONTO IS NOT NULL;
